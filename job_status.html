<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Technician ‚Äì Job Status</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f9;
  margin:0;
}
.header{
  background:#1f3c88;
  color:#fff;
  padding:16px 20px;
  font-size:22px;
  font-weight:bold;
  border-radius:0 0 14px 14px;
}
.container{
  max-width:1200px;
  margin:20px auto;
  padding:0 16px;
}
.filter-bar{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:10px;
  margin-bottom:12px;
}
.filter-bar input, .filter-bar select{
  padding:8px;
  border-radius:6px;
  border:1px solid #ccc;
}
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  border-radius:12px;
  overflow:hidden;
}
thead{
  background:#1f3c88;
  color:#fff;
}
th, td{
  padding:12px;
  border-bottom:1px solid #eee;
  text-align:left;
}
.status{
  padding:6px 12px;
  border-radius:20px;
  font-weight:bold;
  font-size:13px;
}
.OPEN{ background:#ffeb3b; }
.IN_PROGRESS{ background:#90caf9; }
button{
  padding:6px 10px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.pdf-btn{
  background:#4caf50;
  color:#fff;
}
.empty{
  text-align:center;
  padding:20px;
  color:#666;
}
</style>
</head>

<body>

<div class="header">
  ‚Üê <a href="index.html" style="color:#fff;text-decoration:none;">Home</a>
  &nbsp; üîß Technician ‚Äì Job Status
</div>

<div class="container">

  <!-- FILTER -->
  <div class="filter-bar">
    <input placeholder="WO ID" oninput="applyFilter()">
    <input placeholder="Asset" oninput="applyFilter()">
    <input placeholder="Problem" oninput="applyFilter()">
    <select onchange="applyFilter()">
      <option value="">All Priority</option>
      <option>Critical</option>
      <option>High</option>
      <option>Medium</option>
      <option>Low</option>
    </select>
    <select onchange="applyFilter()">
      <option value="">All Status</option>
      <option>OPEN</option>
      <option>IN_PROGRESS</option>
    </select>
  </div>

  <!-- TABLE -->
  <table>
    <thead>
      <tr>
        <th>WO ID</th>
        <th>Asset</th>
        <th>Problem</th>
        <th>Priority</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="tbody">
      <tr><td colspan="6" class="empty">‚è≥ Loading...</td></tr>
    </tbody>
  </table>

</div>

<script>
const API_URL = "https://script.googleusercontent.com/macros/echo?user_content_key=XXXX"; // üî¥ ‡πÉ‡∏™‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
let rows = [];

fetch(API_URL + "&mode=jobStatus")
.then(r=>r.json())
.then(data=>{
  rows = data;
  render(rows);
})
.catch(()=>render([]));

function render(data){
  const tb = document.getElementById("tbody");
  if(!data.length){
    tb.innerHTML = `<tr><td colspan="6" class="empty">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á</td></tr>`;
    return;
  }
  tb.innerHTML = data.map(r=>`
    <tr>
      <td>${r.wo_id}</td>
      <td>${r.asset_id}</td>
      <td>${r.problem}</td>
      <td>${r.priority}</td>
      <td><span class="status ${r.status}">${r.status}</span></td>
      <td>
        ${r.pdf_url
          ? `<button class="pdf-btn" onclick="openPDF('${r.pdf_url}')">üìÑ PDF</button>`
          : '-'}
      </td>
    </tr>
  `).join("");
}

function applyFilter(){
  const f = [...document.querySelectorAll(".filter-bar input, .filter-bar select")]
    .map(e=>e.value.toLowerCase());

  render(rows.filter(r =>
    (!f[0] || r.wo_id.toLowerCase().includes(f[0])) &&
    (!f[1] || r.asset_id.toLowerCase().includes(f[1])) &&
    (!f[2] || r.problem.toLowerCase().includes(f[2])) &&
    (!f[3] || r.priority.toLowerCase()===f[3]) &&
    (!f[4] || r.status.toLowerCase()===f[4])
  ));
}

function openPDF(url){
  window.open(url, "_blank");
}
</script>

</body>
</html>
