<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Job Status ‚Äì Technician</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  margin:0;
  padding:20px;
}

/* ================= HEADER ================= */
.top-nav{
  display:flex;
  align-items:center;
  gap:12px;
  background:#1f3c88;
  color:#fff;
  padding:14px 20px;
  border-radius:10px;
  margin-bottom:20px;
}
.top-nav button{
  background:#fff;
  color:#1f3c88;
  border:none;
  padding:6px 12px;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
}

/* ================= CARD ================= */
.card{
  background:#fff;
  border-radius:12px;
  padding:20px;
  max-width:1000px;
  margin:auto;
}

/* ================= TABLE ================= */
table{
  width:100%;
  border-collapse:collapse;
}
th, td{
  padding:12px 10px;
  border-bottom:1px solid #e0e0e0;
  text-align:left;
  font-size:14px;
}
th{
  background:#1f3c88;
  color:#fff;
  font-weight:bold;
}
tr:hover{
  background:#f9fafc;
}

/* ================= STATUS TAG ================= */
.tag{
  padding:4px 10px;
  border-radius:20px;
  font-size:12px;
  font-weight:bold;
  display:inline-block;
}
.OPEN{ background:#ffeb3b; color:#000; }
.IN_PROGRESS{ background:#03a9f4; color:#fff; }
.DONE{ background:#4caf50; color:#fff; }

/* ================= LOADING / EMPTY ================= */
.center{
  text-align:center;
  padding:30px;
  color:#666;
}
.spinner{
  width:40px;
  height:40px;
  border:4px solid #ddd;
  border-top:4px solid #1f3c88;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:20px auto;
}
@keyframes spin{
  to{ transform:rotate(360deg); }
}
</style>
</head>

<body>

<!-- ================= HEADER ================= -->
<div class="top-nav">
  <button onclick="goHome()">‚¨Ö Home</button>
  <b>üõ† Technician ‚Äì Job Status</b>
</div>

<!-- ================= CONTENT ================= -->
<div class="card">
  <div id="loading" class="center">
    <div class="spinner"></div>
    ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á...
  </div>

  <div id="empty" class="center" style="display:none;">
    üéâ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
  </div>

  <table id="jobTable" style="display:none;">
    <thead>
      <tr>
        <th>WO ID</th>
        <th>Asset</th>
        <th>Problem</th>
        <th>Priority</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="jobBody"></tbody>
  </table>
</div>

<script>
/* ================= CONFIG ================= */
const API_URL = "https://script.google.com/macros/s/AKfycbzPlxZPUvYTiiVPhum7JDbarfIfbpZ2c8_tJa7AZb4OypRJwFB171oC-UqpDdkKMdEhSA/exec";

/* ================= NAV ================= */
function goHome(){
  location.href = "https://airservicepcg-ux.github.io/CMMS/";
}

/* ================= LOAD JOB STATUS ================= */
async function loadJobStatus(){
  try{
    const res = await fetch(API_URL + "?mode=jobStatus");
    const data = await res.json();

    document.getElementById("loading").style.display = "none";

    if(!Array.isArray(data) || data.length === 0){
      document.getElementById("empty").style.display = "block";
      return;
    }

    const tbody = document.getElementById("jobBody");
    tbody.innerHTML = "";

    data.forEach(j=>{
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td><b>${j.wo_id}</b></td>
        <td>${j.asset_id}</td>
        <td>${j.problem}</td>
        <td>${j.priority}</td>
        <td><span class="tag ${j.status}">${j.status}</span></td>
      `;

      tbody.appendChild(tr);
    });

    document.getElementById("jobTable").style.display = "table";

  }catch(err){
    document.getElementById("loading").innerText = "‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
    console.error(err);
  }
}

/* ================= INIT ================= */
loadJobStatus();
</script>

</body>
</html>
